/**
 * 대화방 제목 생성 유틸
 *
 * 역할:
 * - 사용자 질문에서 대화방 제목 자동 생성
 * - 간단한 텍스트 처리로 빠르고 가벼움
 * - 한글/영문 모두 지원
 */
export function makeRoomTitle(text) {
  if (!text) return "새 대화";

  console.group("[대화방 제목 생성]");
  console.log("원본 텍스트:", text);

  // ============================================================
  // 1.공백과 특수문자 제거
  // ============================================================
  const trimmedText = text.trim();

  if (!trimmedText) {
    console.log("결과: 빈 텍스트 → '새 대화' 반환");
    console.groupEnd();
    return "새 대화";
  }

  // ============================================================
  // 2.문장부호 제거 (마침표, 물음표, 느낌표 등)
  // ============================================================
  const cleanedText = trimmedText
    .replace(/[?!.;:,।、]/g, "") // 문장부호 제거
    .trim();

  if (!cleanedText) {
    console.log("결과: 문장부호만 있음 → '새 대화' 반환");
    console.groupEnd();
    return "새 대화";
  }

  // ============================================================
  // 3.단어 분리 (공백 기준)
  // ============================================================
  const words = cleanedText.split(/\s+/);

  console.log("분리된 단어:", words);

  // ============================================================
  // 4.불필요한 단어 필터링 (조사, 동사 등)
  // ============================================================
  //
  // 제외할 단어 목록:
  // - 한글 조사: 이, 가, 을, 를, 에, 는, 고, 으로
  // - 영문 관계사: is, are, am, do, does, did, be, the, a, an, of
  //

  const excludeWords = new Set([
    // 한글 조사 & 동사
    "이",
    "가",
    "을",
    "를",
    "에",
    "는",
    "고",
    "으로",
    "와",
    "도",
    "만",
    "까지",
    "부터",
    "의",
    "에게",
    // 영문
    "is",
    "are",
    "am",
    "do",
    "does",
    "did",
    "be",
    "been",
    "the",
    "a",
    "an",
    "of",
    "in",
    "on",
    "at",
    "to",
    "for",
    "and",
    "or",
    "but",
    "what",
    "how",
    "why",
  ]);

  const meaningfulWords = words.filter(
    (word) =>
      word.length > 0 && // 빈 문자열 제거
      !excludeWords.has(word.toLowerCase()) && // 불필요한 단어 제거
      word.length > 1, // 1글자 단어 제거 (너무 짧음)
  );

  console.log("의미있는 단어:", meaningfulWords);

  // ============================================================
  // 5.최대 3개 단어로 제한
  // ============================================================
  //
  // 제목은 너무 길면 안 되므로 최대 3개 단어만 사용
  //

  const titleWords = meaningfulWords.slice(0, 3);

  // ============================================================
  // 7.결과 생성
  // ============================================================
  const title =
    titleWords.length > 0 ? titleWords.join(" ") : trimmedText.slice(0, 15); // fallback: 앞 15글자

  console.log("생성된 제목:", title);
  console.groupEnd();

  return title + "..."; // 제목 끝에 "..." 추가
}
